\o /tmp/app_event_prod-res.sql;
CREATE ROLE admin;
CREATE ROLE appli;
CREATE ROLE viewer;

CREATE USER app_event_admin_prod  WITH ENCRYPTED PASSWORD '8ae7f3057d5b33b931db1655105cdbe6';
CREATE USER app_event_appli_prod  WITH ENCRYPTED PASSWORD '212618da250b5986aef95e38527e7811';
CREATE USER app_event_viewer_prod WITH ENCRYPTED PASSWORD 'bc645e0f7a561096ffb80f3625182626';

GRANT admin  TO app_event_admin_prod;
GRANT appli  TO app_event_appli_prod;
GRANT viewer TO app_event_viewer_prod;

CREATE TABLESPACE app_event_data_ts  OWNER app_event_admin_prod LOCATION '/custom/data/pgsql/9.5/app_event/app_event_data_ts';
CREATE TABLESPACE app_event_index_ts OWNER app_event_admin_prod LOCATION '/custom/data/pgsql/9.5/app_event/app_event_index_ts';

CREATE DATABASE app_event_prod ENCODING 'UTF8' OWNER app_event_admin_prod TABLESPACE app_event_data_ts;

\connect app_event_prod;

CREATE SCHEMA app_event AUTHORIZATION app_event_admin_prod;

DROP SCHEMA public;

GRANT CONNECT ON DATABASE app_event_prod TO GROUP admin;
GRANT CREATE ON SCHEMA app_event TO GROUP admin;
ALTER DEFAULT PRIVILEGES FOR ROLE app_event_admin_prod IN SCHEMA app_event GRANT ALL ON TABLES TO admin;
ALTER DEFAULT PRIVILEGES FOR ROLE app_event_admin_prod IN SCHEMA app_event GRANT ALL ON SEQUENCES TO admin;
ALTER DEFAULT PRIVILEGES FOR ROLE app_event_admin_prod IN SCHEMA app_event GRANT ALL ON FUNCTIONS TO admin;

GRANT CONNECT ON DATABASE app_event_prod TO GROUP appli;
GRANT USAGE ON SCHEMA app_event TO GROUP appli;
ALTER DEFAULT PRIVILEGES FOR ROLE app_event_admin_prod IN SCHEMA app_event GRANT SELECT, INSERT, UPDATE, DELETE, TRUNCATE ON TABLES TO appli;
ALTER DEFAULT PRIVILEGES FOR ROLE app_event_admin_prod IN SCHEMA app_event GRANT USAGE, SELECT ON SEQUENCES TO appli;
ALTER DEFAULT PRIVILEGES FOR ROLE app_event_admin_prod IN SCHEMA app_event GRANT EXECUTE ON FUNCTIONS TO appli;

GRANT CONNECT ON DATABASE app_event_prod TO GROUP viewer;
GRANT USAGE ON SCHEMA app_event TO GROUP viewer;
ALTER DEFAULT PRIVILEGES FOR ROLE app_event_admin_prod IN SCHEMA app_event GRANT SELECT ON TABLES TO viewer;
ALTER DEFAULT PRIVILEGES FOR ROLE app_event_admin_prod IN SCHEMA app_event GRANT EXECUTE ON FUNCTIONS TO viewer;
\c app_event_prod;
create extension pg_stat_statements;
CREATE EXTENSION pg_qualstats;
CREATE EXTENSION pg_stat_kcache ;
create extension btree_gist ;
create extension powa;
CREATE USER powa LOGIN ENCRYPTED PASSWORD 'powa2016';
GRANT SELECT ON ALL TABLES IN SCHEMA public TO powa;
GRANT SELECT ON pg_statistic TO powa;
\o
